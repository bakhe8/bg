<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÙˆØ±Ù‚Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø·Ø§Ø¨Ø§Øª Ø§Ù„Ø¶Ù…Ø§Ù†</title>
  <style>
    /* ØªØ­Ù…ÙŠÙ„ Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø®Ø· Ø¨Ø£ÙˆØ²Ø§Ù† Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ */
    @font-face {
      font-family: 'AlMohanad-Regular';
      src: url("assets/AL-Mohanad.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: 'AlMohanad-Bold';
      src: url("assets/AL-Mohanad Bold.ttf") format("truetype");
      font-weight: 600;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: 'AlMohanad-ExtraBold';
      src: url("assets/AL-Mohanad Extra Bold.ttf") format("truetype");
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }

    :root {
      --font-regular: 'AlMohanad-Regular', 'Segoe UI', Tahoma, sans-serif;
      --font-bold: 'AlMohanad-Bold', 'Segoe UI', Tahoma, sans-serif;
      --font-extrabold: 'AlMohanad-ExtraBold', 'Segoe UI', Tahoma, sans-serif;
      --page-width: 210mm;
      --page-height: 297mm;
      --subject-accent: rgba(0, 0, 0, 0.08);
    }

    /* Ø¶Ø¨Ø· Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    /* Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„ØµÙØ­Ø© */
    body {
      font-family: var(--font-bold);
      line-height: 1.8;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      background: #f5f5f5;
      padding: 20px;
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
    .toolbar {
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 10;
    }

    .toolbar button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      background: #0b6fa4;
      color: #fff;
      box-shadow: 0 8px 18px rgba(11, 111, 164, 0.25);
      margin: 5px;
    }

    .toolbar button:hover {
      opacity: 0.9;
    }

    /* Ø§Ù„ÙˆØ±Ù‚Ø© */
    .letter-sheet {
      width: var(--page-width);
      height: var(--page-height);
      margin: 20px auto;
      padding: 0;
      border: none;
      border-radius: 0;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      background: white;
    }

    /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ±Ù‚Ø© */
    .sheet-content {
      position: relative;
      z-index: 1;
      width: 100%;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
      padding: 60mm 25mm 0mm 25mm;
    }

    /* Ø­Ù‚Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø®Ø·Ø§Ø¨ */
    .writing-area {
      width: 100%;
      flex: 1;
    }

    /* ÙƒÙ„ Ø³Ø·Ø± Ù…Ù†ÙØµÙ„ Ù…Ø¹ ØªØ¨Ø§Ø¹Ø¯ Ù…ØªØ³Ø§ÙˆÙ */
    .letter-line {
      margin-bottom: 4mm;
    }

    .letter-line:last-child {
      margin-bottom: 0;
    }

    .letter-paragraph {
      margin: 0;
      text-align: justify;
     }

    /* Ø§Ù„ØªØ°ÙŠÙŠÙ„ */
    .sheet-footer {
      margin: -5mm 20mm 20mm 20mm;
      border: none;
      background: transparent;
      outline: none;
      font-family: var(--font-regular);
      font-size: 0.6rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8mm;
    }

    /* Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ°ÙŠÙŠÙ„ */
    .sheet-footer span {
      flex: 1;
      display: inline-block;
      white-space: pre-wrap;
    }

    .sheet-footer .footer-left {
      text-align: right;
    }

    .sheet-footer .footer-right {
      text-align: left;
    }

    /* ÙƒØªÙ„Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù… */
    .preview-container {
      display: flex;
      flex-direction: column;
      gap: 1mm;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      gap: 12mm;
      align-items: flex-start;
    }

    .preview-recipient {
      flex: 1;
      line-height: 1.6;
    }

    .preview-salutation {
      text-align: left;
    }

    /* Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ */
    .preview-subject {
      background: var(--subject-accent);
      display: flex;
      gap: 8px;
      padding: 0;
    }

    .preview-subject-label {
      white-space: nowrap;
    }

    .preview-subject-text {
      flex: 1;
      text-align: right;
    }

    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    .preview-content {
      display: flex;
      flex-direction: column;
      gap: 1mm;
    }

    .preview-greeting {
      margin: 0;
    }

    .preview-address-box {
      margin: 0;
      padding-right: 30px;
    }

    /* ØªÙˆÙ‚ÙŠØ¹ */
    .preview-note {
      text-align: right;
      margin-bottom: 10px;
      padding-right: 100px;
    }

    .preview-signature {
      text-align: center;
      margin-right: 300px;
    }

    .preview-signature div + .signature-seal {
      margin-top: 18mm;
    }

    /* Editor Panel - Visible by default */
    .editor-panel {
      position: fixed;
      top: 80px;
      left: 20px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      width: 320px;
      max-height: 75vh;
      overflow-y: auto;
      z-index: 100;
      border: 2px solid #0b6fa4;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      font-size: 13px;
      margin-bottom: 5px;
      font-weight: bold;
      color: #2c3e50;
    }

    .form-control {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
      font-family: var(--font-regular);
    }

    .form-control:focus {
      outline: none;
      border-color: #0b6fa4;
      box-shadow: 0 0 0 2px rgba(11, 111, 164, 0.1);
    }

    .update-btn {
      width: 100%;
      padding: 10px;
      background: #0b6fa4;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: var(--font-bold);
      font-size: 14px;
      margin-top: 10px;
    }

    .update-btn:hover {
      background: #095d8a;
    }

    /* PDF Template (hidden) */
    .pdf-template {
      position: absolute;
      top: -10000px;
      left: -10000px;
      width: var(--page-width);
      height: var(--page-height);
      background: white;
      background-image: url("assets/External Form.svg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    @media print {
      @page {
        size: A4;
        margin: 0;
      }
      body {
        display: block;
        margin: 0;
        padding: 0;
        min-height: auto;
        align-items: initial;
        justify-content: flex-start;
        background: white;
      }
      #actionToolbar, .editor-panel {
        display: none !important;
      }
      .letter-sheet {
        box-shadow: none;
        margin: 0;
      }
    }

  </style>
</head>
<body id="pageRoot">
  <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØµØ¯ÙŠØ± -->
  <div class="toolbar" id="actionToolbar">
    <button id="downloadBtn" aria-controls="letterSheetCanvas">Ø§Ø³ØªØ®Ø±Ø§Ø¬ PDF</button>
  </div>

  <!-- Editor Panel - Now Visible by Default -->
  <div class="editor-panel" id="editorPanel">
    <h3 style="margin: 0 0 15px 0; color: #2c3e50; text-align: center;">âœï¸ Ù…Ø­Ø±Ø± Ø§Ù„Ø®Ø·Ø§Ø¨</h3>
    
    <div class="form-group">
      <label for="bankName">Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ:</label>
      <input type="text" id="bankName" class="form-control" value="Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ">
    </div>
    <div class="form-group">
      <label for="bankCenter">Ø§Ù„Ù…Ø±ÙƒØ²:</label>
      <input type="text" id="bankCenter" class="form-control" value="Ù…Ø±ÙƒØ² Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø©">
    </div>
    <div class="form-group">
      <label for="bankPoBox">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯:</label>
      <input type="text" id="bankPoBox" class="form-control" value="3555 Ø¬Ø¯Ù‡ 21481">
    </div>
    <div class="form-group">
      <label for="bankEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
      <input type="email" id="bankEmail" class="form-control" value="tradej-lg@alahli.com">
    </div>
    <div class="form-group">
      <label for="guaranteeNumber">Ø±Ù‚Ù… Ø§Ù„Ø¶Ù…Ø§Ù†:</label>
      <input type="text" id="guaranteeNumber" class="form-control" value="M113528">
    </div>
    <div class="form-group">
      <label for="contractNumber">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯:</label>
      <input type="text" id="contractNumber" class="form-control" value="434153">
    </div>
    <div class="form-group">
      <label for="guaranteeAmount">Ù…Ø¨Ù„Øº Ø§Ù„Ø¶Ù…Ø§Ù†:</label>
      <input type="text" id="guaranteeAmount" class="form-control" value="20,000.00">
    </div>
    <div class="form-group">
      <label for="extensionDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</label>
      <input type="text" id="extensionDate" class="form-control" value="30 ÙŠÙˆÙ„ÙŠÙˆ 2026">
    </div>
    <div class="form-group">
      <label for="companyName">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©:</label>
      <input type="text" id="companyName" class="form-control" value="Ø´Ø±ÙƒØ© Ø±Ø¤ÙŠØ© Ø§Ù„Ù‚ÙˆÙ‰ Ù„Ù„Ù…ØµØ§Ø¹Ø¯">
    </div>
    <button class="update-btn" onclick="updatePreview()">
      ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
    </button>
  </div>

  <!-- Ù…Ø³Ø±Ø­ Ø§Ù„ÙˆØ±Ù‚Ø© Ø¨Ù‚ÙŠØ§Ø³ A4 -->
  <main class="letter-sheet" id="letterSheetCanvas" aria-label="ÙˆØ±Ù‚Ø© Ø§Ù„Ø®Ø·Ø§Ø¨ A4">
    <div class="sheet-content" id="sheetContent">
      <!-- Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ­Ø±ÙŠØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù†Øµ Ø§Ù„Ø®Ø·Ø§Ø¨ -->
      <section class="writing-area" id="letterWritingArea" contenteditable="false" aria-label="Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³Ø©">
        <div style="display:none;" aria-hidden="true">ØªÙ†Ø¨ÙŠÙ‡ Ø¯Ø§Ø®Ù„ÙŠ: ÙŠØ±Ø¬Ù‰ Ø¹Ø¯Ù… ØªØ¹Ø¯ÙŠÙ„ Ø®ØµØ§Ø¦Øµ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŒ ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø£Ø¯Ù†Ø§Ù‡ ÙÙ‚Ø·.</div>

        <!-- Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø®Ø·Ø§Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ø³ØªØ®Ø¯Ù…Ù‹Ø§ Ù†ÙØ³ Ù‡ÙŠÙƒÙ„Ø© preview Ù„Ø¶Ù…Ø§Ù† ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Øµ -->
        <article class="preview-container" id="primaryLetter">
          <div class="preview-header">
            <div class="preview-recipient-name" id="bank_name">
              <div>Ø§Ù„Ø³Ù€Ø§Ø¯Ø© / Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</div>
            </div>
            <div class="preview-salutation">
              <div>Ø§Ù„Ù…Ø­ØªØ±Ù…ÙŠÙ†</div>
            </div>
          </div>
          <div class="preview-recipient" id="bank_details">
            <div>Ù…Ø±ÙƒØ² Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø©</div>
            <div>Øµ.Ø¨. 3555 Ø¬Ø¯Ù‡ 21481</div>
            <div>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: tradej-lg@alahli.com</div>
          </div>

          <div class="preview-greeting">
            <div>Ø§Ù„Ø³Ù‘ÙÙ„Ø§Ù… Ø¹Ù„ÙŠÙƒÙÙ… ÙˆØ±Ø­Ù…ÙØ© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙÙ‡</div>
          </div>

          <div class="preview-subject">
            <div class="preview-subject-label">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</div>
            <div class="preview-subject-text" id="subject_text">Ø·Ù„Ø¨ ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø±Ù‚Ù… (M113528) ÙˆØ§Ù„Ø¹Ø§Ø¦Ø¯ Ù„Ù„Ø¹Ù‚Ø¯ Ø±Ù‚Ù… (434153).</div>
          </div>

          <div class="preview-content">
            <p class="letter-paragraph" id="content_paragraph1">
              Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…ÙˆØ¶Ø­ Ø£Ø¹Ù„Ø§Ù‡ØŒ ÙˆØ§Ù„ØµØ§Ø¯Ø± Ù…Ù†ÙƒÙ… Ù„ØµØ§Ù„Ø­Ù†Ø§ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ Ø´Ø±ÙƒØ© Ø±Ø¤ÙŠØ© Ø§Ù„Ù‚ÙˆÙ‰ Ù„Ù„Ù…ØµØ§Ø¹Ø¯
              Ø¨Ù…Ø¨Ù„Øº Ù‚Ø¯Ø±Ù‡ (20,000.00) Ø±ÙŠØ§Ù„ØŒ Ù†Ø£Ù…Ù„ Ù…Ù†ÙƒÙ… ØªÙ…Ø¯ÙŠØ¯ ÙØªØ±Ø© Ø³Ø±ÙŠØ§Ù† Ø§Ù„Ø¶Ù…Ø§Ù† Ø­ØªÙ‰ ØªØ§Ø±ÙŠØ® 30 ÙŠÙˆÙ„ÙŠÙˆ 2026Ù… Ù…Ø¹ Ø¨Ù‚Ø§Ø¡
              Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±ØŒ ÙˆØ¥ÙØ§Ø¯ØªÙ†Ø§ Ø¨Ø°Ù„Ùƒ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ù…Ø®ØµØµ Ù„Ù„Ø¶Ù…Ø§Ù†Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ù„Ø¯Ù‰
              Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ ÙÙŠØµÙ„ Ø§Ù„ØªØ®ØµØµÙŠ ÙˆÙ…Ø±ÙƒØ² Ø§Ù„Ø£Ø¨Ø­Ø§Ø« Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ (bgfinance@kfshrc.edu.sa)ØŒ ÙƒÙ…Ø§ Ù†Ø£Ù…Ù„ Ù…Ù†ÙƒÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£ØµÙ„
              ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¶Ù…Ø§Ù† Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ§Ù„ÙŠ:
            </p>

            <div class="preview-address-box">
              <div>Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ ÙÙŠØµÙ„ Ø§Ù„ØªØ®ØµØµÙŠ ÙˆÙ…Ø±ÙƒØ² Ø§Ù„Ø£Ø¨Ø­Ø§Ø« - Ø§Ù„Ø±ÙŠØ§Ø¶</div>
              <div>Øµ.Ø¨ 3354 Ø§Ù„Ø±ÙŠØ§Ø¶ 11211</div>
              <div>Ù…ÙƒØªØ¨ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</div>
            </div>

            <p class="letter-paragraph">
              Ø¹Ù„Ù…Ù‹Ø§ Ø¨Ø£Ù†Ù‡ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ØªÙ…ÙƒÙ† Ø§Ù„Ø¨Ù†Ùƒ Ù…Ù† ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù…Ø°ÙƒÙˆØ± Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ø¯Ø© Ø³Ø±ÙŠØ§Ù†Ù‡ ÙÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù†Ùƒ Ø¯ÙØ¹
              Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ù…Ø§Ù† Ø¥Ù„ÙŠÙ†Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù….
            </p>
          </div>

          <div class="preview-clearfix">
            <div class="letter-line preview-note">ÙˆÙØªÙØ¶Ù‘ÙÙ„ÙˆØ§ Ø¨ÙÙ‚Ø¨ÙÙˆÙ„ Ø®ÙØ§Ù„ÙØµ ØªØ­ÙŠÙ‘ÙØ§ØªÙŠ</div>
            <div class="preview-signature">
              <div>Ù…ÙØ¯ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ù‘ÙØ© Ù„Ù„Ø¹Ù…Ù„ÙŠÙ‘ÙØ§Øª Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠÙ‘ÙØ©</div>
              <div class="signature-seal">Ø³ÙØ§Ù…ÙŠ Ø¨Ù† Ø¹Ø¨Ù‘ÙØ§Ø³ Ø§Ù„ÙØ§ÙŠØ²</div>
            </div>
          </div>
        </article>
      </section>
    </div>
    <!-- ØªÙˆÙ‚ÙŠØ¹ Ø£Ùˆ ØªØ°ÙŠÙŠÙ„ Ø¯Ø§Ø®Ù„ÙŠ Ø¶Ù…Ù† Ù†ÙØ³ Ø§Ù„ÙˆØ±Ù‚Ø© -->
    <div class="sheet-footer" id="sheetFooter" aria-label="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ÙÙŠ Ø§Ù„ØªØ°ÙŠÙŠÙ„">
      <span class="footer-left" id="footerLeftField" contenteditable="false">MBC: 9-2</span>
      <span class="footer-right" id="footerRightField" contenteditable="false">BAMZ</span>
    </div>
  </main>

  <!-- Hidden PDF Template with Background -->
  <div class="pdf-template" id="pdfTemplate">
    <div class="sheet-content">
      <div class="preview-container" id="pdfContent">
        <!-- Ø³ÙŠØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ -->
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // State Management
    const appState = {
      bank: {
        name: "Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ",
        center: "Ù…Ø±ÙƒØ² Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø©",
        poBox: "3555 Ø¬Ø¯Ù‡ 21481",
        email: "tradej-lg@alahli.com"
      },
      guarantee: {
        number: "M113528",
        contract: "434153",
        amount: "20,000.00",
        extensionDate: "30 ÙŠÙˆÙ„ÙŠÙˆ 2026"
      },
      company: {
        name: "Ø´Ø±ÙƒØ© Ø±Ø¤ÙŠØ© Ø§Ù„Ù‚ÙˆÙ‰ Ù„Ù„Ù…ØµØ§Ø¹Ø¯"
      }
    };

    // DOM Elements
    const elements = {
      // Inputs
      bankName: document.getElementById('bankName'),
      bankCenter: document.getElementById('bankCenter'),
      bankPoBox: document.getElementById('bankPoBox'),
      bankEmail: document.getElementById('bankEmail'),
      guaranteeNumber: document.getElementById('guaranteeNumber'),
      contractNumber: document.getElementById('contractNumber'),
      guaranteeAmount: document.getElementById('guaranteeAmount'),
      extensionDate: document.getElementById('extensionDate'),
      companyName: document.getElementById('companyName'),
      
      // Preview Elements
      bankNamePreview: document.getElementById('bank_name'),
      bankDetails: document.getElementById('bank_details'),
      subjectText: document.getElementById('subject_text'),
      contentParagraph1: document.getElementById('content_paragraph1')
    };

    // Initialize from localStorage or defaults
    function initializeApp() {
      const savedState = localStorage.getItem('guaranteeLetterState');
      if (savedState) {
        Object.assign(appState, JSON.parse(savedState));
      }
      updateInputsFromState();
      updatePreview();
      setupEventListeners();
    }

    // Update inputs from state
    function updateInputsFromState() {
      elements.bankName.value = appState.bank.name;
      elements.bankCenter.value = appState.bank.center;
      elements.bankPoBox.value = appState.bank.poBox;
      elements.bankEmail.value = appState.bank.email;
      elements.guaranteeNumber.value = appState.guarantee.number;
      elements.contractNumber.value = appState.guarantee.contract;
      elements.guaranteeAmount.value = appState.guarantee.amount;
      elements.extensionDate.value = appState.guarantee.extensionDate;
      elements.companyName.value = appState.company.name;
    }

    // Update state from inputs
    function updateStateFromInputs() {
      appState.bank.name = elements.bankName.value;
      appState.bank.center = elements.bankCenter.value;
      appState.bank.poBox = elements.bankPoBox.value;
      appState.bank.email = elements.bankEmail.value;
      appState.guarantee.number = elements.guaranteeNumber.value;
      appState.guarantee.contract = elements.contractNumber.value;
      appState.guarantee.amount = elements.guaranteeAmount.value;
      appState.guarantee.extensionDate = elements.extensionDate.value;
      appState.company.name = elements.companyName.value;
      
      localStorage.setItem('guaranteeLetterState', JSON.stringify(appState));
    }

    // Setup event listeners for real-time updates
    function setupEventListeners() {
      const inputs = [
        'bankName', 'bankCenter', 'bankPoBox', 'bankEmail',
        'guaranteeNumber', 'contractNumber', 'guaranteeAmount', 'extensionDate',
        'companyName'
      ];
      
      inputs.forEach(inputId => {
        document.getElementById(inputId).addEventListener('input', function() {
          updateStateFromInputs();
          updatePreview();
        });
      });
    }

    // Update preview
    function updatePreview() {
      // Update bank information
      elements.bankNamePreview.innerHTML = `<div>Ø§Ù„Ø³Ù€Ø§Ø¯Ø© / ${appState.bank.name}</div>`;
      elements.bankDetails.innerHTML = `
        <div>${appState.bank.center}</div>
        <div>Øµ.Ø¨. ${appState.bank.poBox}</div>
        <div>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${appState.bank.email}</div>
      `;

      // Update subject
      elements.subjectText.textContent = 
        `Ø·Ù„Ø¨ ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø±Ù‚Ù… (${appState.guarantee.number}) ÙˆØ§Ù„Ø¹Ø§Ø¦Ø¯ Ù„Ù„Ø¹Ù‚Ø¯ Ø±Ù‚Ù… (${appState.guarantee.contract}).`;

      // Update content
      elements.contentParagraph1.innerHTML = `
        Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…ÙˆØ¶Ø­ Ø£Ø¹Ù„Ø§Ù‡ØŒ ÙˆØ§Ù„ØµØ§Ø¯Ø± Ù…Ù†ÙƒÙ… Ù„ØµØ§Ù„Ø­Ù†Ø§ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ ${appState.company.name}
        Ø¨Ù…Ø¨Ù„Øº Ù‚Ø¯Ø±Ù‡ (${appState.guarantee.amount}) Ø±ÙŠØ§Ù„ØŒ Ù†Ø£Ù…Ù„ Ù…Ù†ÙƒÙ… ØªÙ…Ø¯ÙŠØ¯ ÙØªØ±Ø© Ø³Ø±ÙŠØ§Ù† Ø§Ù„Ø¶Ù…Ø§Ù† Ø­ØªÙ‰ ØªØ§Ø±ÙŠØ® ${appState.guarantee.extensionDate}Ù… Ù…Ø¹ Ø¨Ù‚Ø§Ø¡
        Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±ØŒ ÙˆØ¥ÙØ§Ø¯ØªÙ†Ø§ Ø¨Ø°Ù„Ùƒ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ù…Ø®ØµØµ Ù„Ù„Ø¶Ù…Ø§Ù†Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ù„Ø¯Ù‰
        Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ ÙÙŠØµÙ„ Ø§Ù„ØªØ®ØµØµÙŠ ÙˆÙ…Ø±ÙƒØ² Ø§Ù„Ø£Ø¨Ø­Ø§Ø« Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ (bgfinance@kfshrc.edu.sa)ØŒ ÙƒÙ…Ø§ Ù†Ø£Ù…Ù„ Ù…Ù†ÙƒÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£ØµÙ„
        ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¶Ù…Ø§Ù† Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ§Ù„ÙŠ:
      `;
    }

    // Download PDF
    async function downloadPDF() {
      try {
        if (typeof html2canvas === 'undefined' || typeof window.jspdf === 'undefined') {
          alert('âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø§Øª PDF');
          return;
        }

        const btn = document.getElementById('downloadBtn');
        btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...';
        btn.disabled = true;

        // Update PDF template content
        document.getElementById('pdfContent').innerHTML = document.getElementById('primaryLetter').innerHTML;

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });

        // Capture the PDF template (with background)
        const pdfTemplate = document.getElementById('pdfTemplate');
        const canvas = await html2canvas(pdfTemplate, {
          scale: 3,
          useCORS: true,
          allowTaint: false,
          backgroundColor: '#ffffff',
          width: pdfTemplate.offsetWidth,
          height: pdfTemplate.offsetHeight
        });

        const imgData = canvas.toDataURL('image/png');
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        
        pdf.addImage(imgData, 'PNG', 0, 0, pageWidth, pageHeight);
        
        const fileName = `Ø·Ù„Ø¨_ØªÙ…Ø¯ÙŠØ¯_Ø§Ù„Ø¶Ù…Ø§Ù†_${appState.guarantee.number}.pdf`;
        pdf.save(fileName);
        
        btn.textContent = 'Ø§Ø³ØªØ®Ø±Ø§Ø¬ PDF';
        btn.disabled = false;
        
        alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ PDF Ø¨Ù†Ø¬Ø§Ø­!');
      } catch (error) {
        console.error(error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ PDF: ' + error.message);
        
        const btn = document.getElementById('downloadBtn');
        btn.textContent = 'Ø§Ø³ØªØ®Ø±Ø§Ø¬ PDF';
        btn.disabled = false;
      }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    // Set up download button
    document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
  </script>
</body>
</html>