# BGLApp

ูุธุงู ูุชูุงูู ููุนุงูุฌุฉ ุฎุทุงุจุงุช ุงูุถูุงู ุงูุจูููุฉ: ุฑูุน ูููุงุช Excelุ ุชุญููููุง ุฅูู JSON ููุญุฏุ ูุฑุงุฌุนุฉ ุงูุฃุนูุฏุฉ ุบูุฑ ุงููุนุฑููุฉุ ุญูุธ ุงูุฎุทุงุจุงุช ูุทุจุงุนุชูุง ููุฑุงู ุนุจุฑ ูุงุฌูุฉ ูุงุญุฏุฉ.

## ุงูุชููุฆุฉ ุงูุฃูููุฉ

```
pip install -r requirements.txt
```

> ๐ก **ููุงุญุธุฉ WeasyPrint:** ุนูู ุฃูุธูุฉ Windows ุณุชุญุชุงุฌ ูุชุซุจูุช ููุชุจุงุช WeasyPrint (Cairo/Pango/GTK) ูู ุงููููุน ุงูุฑุณูู ูุจู ุชุดุบูู `/api/pdf`.
>
> ูุชุณููู ุฐูู ุฃุถููุง ุณูุฑุจุชูุง ุฌุงูุฒูุง:
> ```powershell
> # ูู ุฌุฐุฑ ุงููุณุชูุฏุน
> powershell -ExecutionPolicy Bypass -File BGLApp_Portable\setup\install_gtk_runtime.ps1
> ```
> ุณููุซุจูุช ุงูุญุฒูุฉ ูู `%LOCALAPPDATA%\GTK3-Runtime` (ูููู ุชุนุฏูู ุงููุณุงุฑ ุนุจุฑ `-InstallPath`) ููููู
> ุจุญูุธ ุงููุณุงุฑ ูู `BGLApp_Portable\gtk_runtime_path.txt` ุญุชู ูุถููู ุงููุดุบูู ุงููุญููู ุชููุงุฆููุง ุฅูู PATH.

## ุชุดุบูู ุงูุฎุงุฏู ุงูุฑุณูู (FastAPI + Uvicorn)

```
python -m main.app  # ูุณุชุฎุฏู uvicorn ูุชุดุบูู main.api.server:app
```
- ูุงุฌูุฉ ุงูุทุจุงุนุฉ: <http://localhost:5000>
- ููุญุฉ ูุฑุงุฌุนุฉ ุงูุฃุนูุฏุฉ: <http://localhost:5000/review>
- ููุญุฉ ุงููุฑุงูุจุฉ (ุนุฑุถ ุงูุณุฌูุงุช): <http://localhost:5000/monitor> _(ุงุฎุชูุงุฑููุง ูุญููุฉ ุจู Basic Auth)_.
- ุชูููุฏ PDF ูู ุงูุฎุงุฏู: ุฒุฑ "ุชุญููู PDF ูู ุงูุฎุงุฏู" ุฃู ุนุจุฑ <http://localhost:5000/api/pdf>.
- ุชูุซูู Swagger/OpenAPI: <http://localhost:5000/docs> ู <http://localhost:5000/redoc>.

## ุงูุจููุฉ ุงูุญุงููุฉ

```
BGLApp/
โ legacy/                โ ูุฑุฌุน ุซุงุจุช (ูุง ูููุณ)
โ transition/            โ ูุณุงุญุฉ ุงูุชุทููุฑ ุงููุณุงูุฏุฉ
โ main/                  โ ุงููุธุงู ุงูุชุดุบููู
    โ app.py             โ ููุทุฉ ุชุดุบูู Flask ุงูุฑุณููุฉ
    โ api/               โ ูุงุฌูุงุช /api (ุฑูุนุ ุญูุธุ ูุฑุงุฌุนุฉ)
    โ web/               โ ูุณุงุฑุงุช ุงููุงุฌูุฉ (index / preview / review)
    โ bg_ui/             โ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ููุทุจุงุนุฉ ูุงููุฑุงุฌุนุฉ
    โ data/              โ ุฃุฑุดูู JSON/PDF + ุณุฌูุงุช + ุจูุงูุงุช ูุฑุงุฌุนุฉ
    โ config.py          โ ูุณุงุฑุงุช ุซุงุจุชุฉ + ุฅุนุฏุงุฏุงุช ุงูุจูุฆุฉ (BGLAPP_*)
    โ ...
```

## ุฏูุฑุฉ ุงูุนูู

1. **ุฑูุน** ููู Excel (ูุงุญุฏ ุฃู ุนุฏุฉ ูููุงุช).
2. **ุชุญููู** ุชููุงุฆู ุนุจุฑ ุฎูุงุฑุฒููุฉ ุงูุชุทุจูุน ุงูุฐูู (transition/backend/data_pipeline).
3. **ูุฑุงุฌุนุฉ** ุงูุฃุนูุฏุฉ ุบูุฑ ุงููุนุฑููุฉ ูู ุตูุญุฉ `/review` ูุฅุถุงูุชูุง ูููุฑุงุฌุน ุฃู ุชุฌุงูููุง.
4. **ุญูุธ/ุทุจุงุนุฉ**: ุชุนุจุฆุฉ ุงููุงูุจ ุงูุจููู ูุจุงุดุฑุฉ ุซู ุชุญููู PDF ุฃู ุฅุฑุณุงู JSON ุฅูู `/api/letters`.

## ุณุฌูุงุช ุงููุธุงู

- main/data/logs/convert.log: ูู ุนูููุงุช ุงูุฑูุน/ุงูุชุญููู.
- main/data/logs/letters.log: ูู ุนูููุงุช ุญูุธ ุงูุฎุทุงุจุงุช.
- main/data/logs/review.log: ุฃุญุฏุงุซ ููุญุฉ ุงููุฑุงุฌุนุฉ.
- main/data/review/unknown_columns.log: ุณุฌู ุงูุฃุนูุฏุฉ ุบูุฑ ุงููุนุฑูููุฉ.

## ููุงุญุธุงุช ุฅุถุงููุฉ

- ุฃู ุชุนุฏูู ูู ุงูุฃุนูุฏุฉ ุงููุฑุฌุนูุฉ ูุชู ูู ุฎูุงู ูุงุฌูุฉ ุงููุฑุงุฌุนุฉ ุฃู ูุญุฑุฑ ุงูุจูุงูุงุชุ ุงูุฎูุงุฑุฒููุฉ ุชุชุจูู ุงูุชุญุฏูุซ ูุจุงุดุฑุฉ.
- ุงููุณุฎุฉ ุงูุงูุชูุงููุฉ (transition/) ุชุจูู ููุฑุฌูุน ุฃู ุงูุงุฎุชุจุงุฑุงุช ููุง ุชูุณุชุฎุฏู ูู ุงูุชุดุบูู.
- ูุง ุชูุฑูุน ูุฎุฑุฌุงุช main/data/archives/ ู main/data/logs/ ุฅูู Gitุ ูุชู ุชุฌุงูููุง ุชููุงุฆูุงู.
- ูุชูุดูุท ุงูุตูุงุญูุงุช ูุงูุชูุจููุงุช:
  - ุนููู `BGLAPP_MONITOR_USER` ู `BGLAPP_MONITOR_PASS` ูุญูุงูุฉ `/monitor`, `/review`, `/api/logs` ุจู Basic Auth.
  - ุนููู `BGLAPP_ALERT_WEBHOOK` (Slack ุฃู ุฃู Webhook) + `BGLAPP_ALERT_TIMEOUT` (ุงุฎุชูุงุฑู) ูุชูููู ุชูุจูู ููุฑู ุนูุฏ ูุดู ุงูุชุญููู ุฃู ุญูุธ ุงูุฎุทุงุจ.

## ุงูุฅุตุฏุงุฑ ุงููุญููู (Portable)

1. ููุฌุฏ ูุฌูุฏ `BGLApp_Portable/` ูุญุชูู ุนูู ูุณุฎุฉ ููุชููุฉ ุฐุงุชููุง ูู ุงูุชุทุจูู.
2. ูุชุดุบููู ุนูู ุฃู ูุธุงู:
   - Windows: ุดุบูู `launcher/run_portable.bat`.
   - Linux/macOS: `bash launcher/run_portable.sh` (ูุน ุงูุชุฃูุฏ ูู ุฃู Python ูุชููุฑ ุฃู ุงุณุชุฎุฏุงู runtime ุงููุถูู ุนูู ูููุฏูุฒ).
3. ูุชุฌููุฒ ุงููุณุฎุฉ ุงููุญูููุฉ ูุน Python ูุถูู ูุชุดุบูู ุณูุฑุจุช ุงูุจูุงุก:
   ```bash
   cd BGLApp_Portable
   pip install pyinstaller
   python build_portable.py
   ```
   ุณูููุดุฆ ูุฌูุฏ `dist/BGLApp_Portable` ุงูุฌุงูุฒ ููููู ุฃู ุงูุชุดุบูู ูู USB.
4. ูุชูุนูู ุชูููุฏ PDF ูู ุงูุฎุงุฏู ุนูู Windowsุ ุซุจูุช ููุชุจุงุช GTK/Pango/Cairo ุนุจุฑ:
   ```powershell
   powershell -ExecutionPolicy Bypass -File BGLApp_Portable\setup\install_gtk_runtime.ps1
   ```
   (ุงุณุชุฎุฏู `-InstallPath` ูุชุบููุฑ ุงููุณุงุฑ ุฃู `-Force` ูุฅุนุงุฏุฉ ุงูุชุซุจูุช. ุณููุถุงู ุงููุณุงุฑ ุขูููุง ุนูุฏ ุชุดุบูู ุงููุณุฎุฉ ุงููุญูููุฉ).
5. ููุชุญุฏูุซ ุงูุชููุงุฆู:
   ```bash
   set BGLAPP_AUTO_UPDATE=1
   set BGLAPP_UPDATE_MANIFEST_URL=https://example.com/release_manifest.json
   set BGLAPP_UPDATE_PACKAGE_URL=https://example.com/BGLApp_Portable.zip
   ```
   ุฃู ุดุบูู `python launcher/update_portable.py` ูุฏูููุง ููุชุญูู ูู ูุฌูุฏ ุชุญุฏูุซุงุช.
6. ูุจูุงุก ููู ุชูุตูุจ (Windows):
   - ุซุจุช Inno Setup ุนูู ุฌูุงุฒู.
   - ูููุฐ `iscc setup/BGLApp.iss` ูู ุฏุงุฎู `BGLApp_Portable/`.
   - ุงููุงุชุฌ ุณูููู `BGLApp_Portable_Setup.exe` ุฏุงุฎู ููุณ ุงููุฌูุฏ.
7. ุจุนุฏ ุงูุจูุงุก ุณุชุฌุฏ ุฏุงุฎู `dist/BGLApp_Portable/`:
   - `BGLApp.exe` (ูุณุฎุฉ ุจูุงุฌูุฉ ุฃูุงูุฑ)
   - `BGLApp_Silent.exe` (ูุณุฎุฉ ุตุงูุชุฉ ุจุฏูู ูููุณูู)
   - `run_portable.bat` ู `run_portable_nowindow.py`
   - ููู `autorun.inf` ูุฃููููุฉ ุฌุงูุฒุฉ ููุชุดุบูู ูู USB
8. ููู `release_manifest.json` ูู ุฌุฐุฑ ุงููุณุชูุฏุน ูุซุงู ุฌุงูุฒ ูููู ุฑูุนู ููุง ูู (ูุน ุชุญุฏูุซ ุฑูู ุงูุฅุตุฏุงุฑ ูุงูุฑุงุจุท) ููุนูู ูุน ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู.
